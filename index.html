<script>
const SHEET_CSV_URL = "여기에_구글시트_CSV_링크";

async function loadSheetCSV(){
  const res = await fetch(SHEET_CSV_URL);
  const text = await res.text();
  const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);

  const rows = lines.slice(1);
  const data = {};

  rows.forEach(line=>{
    const [country, year, value] = line.split(",");
    if (!country) return;
    if (!data[country]) data[country] = [];
    data[country].push({ year: year.trim(), value: parseFloat(value) });
  });

  Object.keys(data).forEach(c=>{
    data[c].sort((a,b)=> a.year.localeCompare(b.year));
  });

  return data;
}

let chart;

function drawChart(country, data){
  const labels = data[country].map(d=>d.year);
  const values = data[country].map(d=>d.value);

  const ctx = document.getElementById("chart").getContext("2d");

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: country,
        data: values
      }]
    }
  });
}

(async ()=>{
  const data = await loadSheetCSV();
  const countries = Object.keys(data);

  const sel = document.getElementById("countrySelect");

  countries.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    sel.appendChild(opt);
  });

  sel.addEventListener("change", ()=> drawChart(sel.value, data));

  if (countries.length > 0){
    sel.value = countries[0];
    drawChart(countries[0], data);
  }

  // ✅ 30초마다 자동 새로고침
  setInterval(()=>{
    location.reload();
  }, 30000);

})();
</script>


